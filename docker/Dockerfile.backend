# 🐳 Base image
FROM node:18-alpine

# 🌍 Set working directory inside the container
WORKDIR /usr/src/app

# 📦 Copy root-level files
COPY ../../package.json .
COPY ../../pnpm-lock.yaml .
COPY ../../turbo.json .

# 📁 Copy all monorepo workspaces (packages & apps)
COPY ../../packages ./packages
COPY ../../apps ./apps

# 🔧 Install pnpm and dependencies
RUN npm install -g pnpm && pnpm install --frozen-lockfile

# ✅ Prisma: Generate client manually using full schema path
RUN npx prisma generate --schema=./packages/db/prisma/schema.prisma


# 🚪 Expose the port used by the http-server
EXPOSE 3002

# 🚀 Start the server
CMD ["node", "apps/backend/dist/index.js"]
